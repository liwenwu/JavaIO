<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Chapter16.1 Nonblocking I/O</title>
	<link rel="stylesheet" type="text/css" href="../../styles.css">
	<link rel="stylesheet" type="text/css" href="../../highlight/desert.css">
	<script language="javascript" src="../../highlight/prettify.js" ></script>
  </head>
  
  <body onload="prettyPrint()" >
	<h2>Chapter 16.1 非阻塞I/O(Nonblocking I/O)</h2>
	<pre >
		请允许我展示一个非常简单的可用作测试路由器等东西的网络服务器.服务器接
	受任意客户端的链接.然后向客户端从0到255的字节,然后不断循环.服务器永远不会关闭
	连接它只会等待客户端关闭连接.你可以用它来测试服务器的网络连接速度.示例16-1用
	传统I/O与线程实现了这个服务器.
	</pre>
	<pre class="prettyprint">
	
	import java.io.BufferedOutputStream;
	import java.io.IOException;
	import java.io.OutputStream;
	import java.net.ServerSocket;
	import java.net.Socket;

	public class DataStuffer {
		private static byte[] data = new byte[256];

		public static void main(String[] args) throws IOException {
			int port = 9000;
			for (int i = 0; i < data.length; i++)
				data[i] = (byte) i;
			ServerSocket server = new ServerSocket(port);
			while (true) {
				Socket socket = server.accept();
				Thread stuffer = new StuffThread(socket);
				stuffer.start();
			}
		}

		private static class StuffThread extends Thread {
			private Socket socket;

			public StuffThread(Socket socket) {
				this.socket = socket;
			}

			public void run() {
				try {
					OutputStream out = new BufferedOutputStream(
							socket.getOutputStream());
					while (!socket.isClosed()) {
						out.write(data);
					}
				} catch (IOException ex) {
					if (!socket.isClosed()) {
						try {
							socket.close();
						} catch (IOException e) {
							// Oh well. We tried.
						}
					}
				}
			}
		}

	}
	</pre>
	<pre>
	
	</pre>
  </body>
</html>
